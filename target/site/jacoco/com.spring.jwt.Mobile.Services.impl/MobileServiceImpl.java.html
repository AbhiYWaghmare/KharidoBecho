<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MobileServiceImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JWT-with-Spring-Security</a> &gt; <a href="index.source.html" class="el_package">com.spring.jwt.Mobile.Services.impl</a> &gt; <span class="el_source">MobileServiceImpl.java</span></div><h1>MobileServiceImpl.java</h1><pre class="source lang-java linenums">package com.spring.jwt.Mobile.Services.impl;

import com.spring.jwt.Mobile.Mapper.MobileMapper;
import com.spring.jwt.Mobile.Repository.MobileImageRepository;
import com.spring.jwt.Mobile.Repository.MobileRepository;
import com.spring.jwt.Mobile.Services.MobileService;
import com.spring.jwt.Mobile.dto.MobileRequestDTO;
import com.spring.jwt.Mobile.dto.MobileResponseDTO;
import com.spring.jwt.Mobile.entity.Mobile;
import com.spring.jwt.Mobile.entity.MobileImage;
import com.spring.jwt.entity.Seller;
import com.spring.jwt.exception.mobile.MobileImageException;
import com.spring.jwt.exception.mobile.MobileNotFoundException;
import com.spring.jwt.exception.mobile.MobileValidationException;
import com.spring.jwt.exception.mobile.SellerNotFoundException;
import com.spring.jwt.repository.SellerRepository;
import com.spring.jwt.utils.CloudinaryService;
import jakarta.transaction.Transactional;
import lombok.RequiredArgsConstructor;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.stereotype.Service;
import com.spring.jwt.utils.ByteArrayMultipartFile;
import org.springframework.web.multipart.MultipartFile;

import javax.imageio.IIOImage;
import javax.imageio.ImageIO;
import javax.imageio.ImageWriteParam;
import javax.imageio.ImageWriter;
import javax.imageio.stream.ImageOutputStream;
import java.awt.*;
import java.awt.image.BufferedImage;
import java.io.*;
import java.math.BigDecimal;
import java.math.RoundingMode;
import java.time.OffsetDateTime;
import java.time.Year;
import java.util.*;
import java.util.List;

@Service
<span class="nc" id="L44">@RequiredArgsConstructor</span>
public class MobileServiceImpl implements MobileService {

    private final MobileRepository mobileRepository;
    private final MobileImageRepository mobileImageRepository;
    private final SellerRepository sellerRepository;
    private final CloudinaryService cloudinaryService;
    private static final long MAX_IMAGE_BYTES = 400 * 1024L; // 400 KB


// This method is for Create mobile service
    private void validateCreateRequest(MobileRequestDTO req) {
<span class="nc" id="L56">        validateCommonFields(req, true); //  all fields required</span>
<span class="nc" id="L57">    }</span>

    // This method is for Update mobile service
    private void validateUpdateRequest(MobileRequestDTO req) {

<span class="nc bnc" id="L62" title="All 4 branches missed.">        if (req.getTitle() == null &amp;&amp; req.getDescription() == null &amp;&amp;</span>
<span class="nc bnc" id="L63" title="All 4 branches missed.">                req.getPrice() == null &amp;&amp; req.getNegotiable() == null &amp;&amp;</span>
<span class="nc bnc" id="L64" title="All 4 branches missed.">                req.getCondition() == null &amp;&amp; req.getBrand() == null &amp;&amp;</span>
<span class="nc bnc" id="L65" title="All 4 branches missed.">                req.getModel() == null &amp;&amp; req.getColor() == null &amp;&amp;</span>
<span class="nc bnc" id="L66" title="All 4 branches missed.">                req.getYearOfPurchase() == null &amp;&amp; req.getSellerId() == null) {</span>
<span class="nc" id="L67">            throw new MobileValidationException(&quot;Update request body cannot be empty.&quot;);</span>
        }

<span class="nc" id="L70">        validateCommonFields(req, false); //  but still must remain valid</span>
<span class="nc" id="L71">    }</span>

    //============We create this method because we have to validate this common fileds
    // in both cenarios for Adding Also &amp; for Updating Also so we create common method and implement
    // this in there separte method that we passing in createmobile and updatemobile time method ==========//

    private void validateCommonFields(MobileRequestDTO req, boolean isCreate) {

        //  Seller Check
<span class="nc bnc" id="L80" title="All 4 branches missed.">        if (isCreate || req.getSellerId() != null) {</span>
<span class="nc" id="L81">            Seller seller = sellerRepository.findById(req.getSellerId())</span>
<span class="nc" id="L82">                    .orElseThrow(() -&gt; new SellerNotFoundException(req.getSellerId()));</span>

<span class="nc bnc" id="L84" title="All 2 branches missed.">            if (Boolean.TRUE.equals(seller.isDeleted())) {</span>
<span class="nc" id="L85">                throw new MobileValidationException(&quot;Seller is deleted or inactive.&quot;);</span>
            }
        }

        //  Year Check
<span class="nc bnc" id="L90" title="All 2 branches missed.">        if (req.getYearOfPurchase() != null) {</span>
<span class="nc" id="L91">            int currentYear = Year.now().getValue();</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">            if (req.getYearOfPurchase() &gt; currentYear) {</span>
<span class="nc" id="L93">                throw new MobileValidationException(&quot;Year of purchase cannot be in the future.&quot;);</span>
            }
<span class="nc bnc" id="L95" title="All 2 branches missed.">            if (req.getYearOfPurchase() &lt; 2000) {</span>
<span class="nc" id="L96">                throw new MobileValidationException(&quot;Year of purchase must be after 2000.&quot;);</span>
            }
        }

        //  Price Check
<span class="nc bnc" id="L101" title="All 2 branches missed.">        if (req.getPrice() != null) {</span>
<span class="nc" id="L102">            BigDecimal price = req.getPrice();</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">            if (price.compareTo(BigDecimal.ZERO) &lt;= 0) {</span>
<span class="nc" id="L104">                throw new MobileValidationException(&quot;Price must be greater than zero.&quot;);</span>
            }
<span class="nc bnc" id="L106" title="All 2 branches missed.">            if (price.compareTo(BigDecimal.valueOf(10_000_000)) &gt; 0) {</span>
<span class="nc" id="L107">                throw new MobileValidationException(&quot;Price cannot exceed 1 crore.&quot;);</span>
            }
<span class="nc" id="L109">            req.setPrice(price.setScale(2, RoundingMode.HALF_UP));</span>
        }

        // Condition Check
<span class="nc bnc" id="L113" title="All 2 branches missed.">        if (req.getCondition() != null) {</span>
            try {
<span class="nc" id="L115">                Mobile.Condition.valueOf(req.getCondition().toUpperCase());</span>
<span class="nc" id="L116">            } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L117">                throw new MobileValidationException(&quot;Invalid condition value. Use NEW, USED, or REFURBISHED.&quot;);</span>
<span class="nc" id="L118">            }</span>
        }

        // Duplicate Check
<span class="nc bnc" id="L122" title="All 4 branches missed.">        if (isCreate &amp;&amp; mobileRepository.existsByTitleAndSeller_SellerId(req.getTitle(), req.getSellerId())) {</span>
<span class="nc" id="L123">            throw new MobileValidationException(&quot;Duplicate listing: same title already exists for this seller.&quot;);</span>
        }

        //  Title Check
<span class="nc bnc" id="L127" title="All 4 branches missed.">        if (req.getTitle() != null &amp;&amp; req.getTitle().length() &gt; 150) {</span>
<span class="nc" id="L128">            throw new MobileValidationException(&quot;Title too long. Max 150 characters allowed.&quot;);</span>
        }

        // Description Check
<span class="nc bnc" id="L132" title="All 2 branches missed.">        if (req.getDescription() != null) {</span>
<span class="nc" id="L133">            int words = req.getDescription().trim().split(&quot;\\s+&quot;).length;</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">            if (words &lt; 5) throw new MobileValidationException(&quot;Description must have at least 5 words.&quot;);</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">            if (words &gt; 70) throw new MobileValidationException(&quot;Description cannot exceed 70 words.&quot;);</span>
        }
<span class="nc" id="L137">    }</span>




    @Override
    @Transactional
    public MobileResponseDTO createMobile(MobileRequestDTO req) {

<span class="nc" id="L146">        validateCreateRequest(req);</span>

<span class="nc" id="L148">        Seller seller = sellerRepository.findById(req.getSellerId())</span>
<span class="nc" id="L149">                .orElseThrow(() -&gt; new SellerNotFoundException(req.getSellerId()));</span>

<span class="nc" id="L151">        Mobile m = new Mobile();</span>
<span class="nc" id="L152">        MobileMapper.updateFromRequest(m, req);</span>
<span class="nc" id="L153">        m.setSeller(seller);</span>
<span class="nc" id="L154">        m.setDeleted(false);</span>
<span class="nc" id="L155">        m.setStatus(Mobile.Status.ACTIVE);</span>
<span class="nc" id="L156">        m = mobileRepository.save(m);</span>
<span class="nc" id="L157">        return MobileMapper.toDTO(m);</span>
    }




    @Override
    public Page&lt;MobileResponseDTO&gt; listMobiles(int page, int size, Long sellerId) {
<span class="nc" id="L165">        Pageable p = PageRequest.of(page, size, Sort.by(&quot;createdAt&quot;).descending());</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">        Page&lt;Mobile&gt; pageResult = (sellerId != null) ? mobileRepository.findBySeller_SellerIdAndDeletedFalse(sellerId, p)</span>
<span class="nc" id="L167">                : mobileRepository.findByDeletedFalse(p);</span>
<span class="nc" id="L168">        return pageResult.map(MobileMapper::toDTO);</span>
    }

    @Override
    public MobileResponseDTO getMobile(Long id) {
<span class="nc" id="L173">        Mobile m = mobileRepository.findByMobileIdAndDeletedFalse(id)</span>
<span class="nc" id="L174">                .orElseThrow(() -&gt; new MobileNotFoundException(id));</span>
<span class="nc" id="L175">        return MobileMapper.toDTO(m);</span>
    }




    @Override
    @Transactional
    public MobileResponseDTO updateMobile(Long id, MobileRequestDTO req) {

<span class="nc" id="L185">        validateUpdateRequest(req);</span>

<span class="nc" id="L187">        Mobile m = mobileRepository.findById(id)</span>
<span class="nc" id="L188">                .orElseThrow(() -&gt; new MobileNotFoundException(id));</span>

<span class="nc bnc" id="L190" title="All 2 branches missed.">        if (m.isDeleted()) {</span>
<span class="nc" id="L191">            throw new MobileValidationException(&quot;Cannot update a deleted mobile.&quot;);</span>
        }

<span class="nc" id="L194">        MobileMapper.updateFromRequest(m, req);</span>
<span class="nc" id="L195">        m = mobileRepository.save(m);</span>
<span class="nc" id="L196">        return MobileMapper.toDTO(m);</span>
    }

    @Override
    @Transactional
    public void softDeleteMobile(Long id) {
<span class="nc" id="L202">        Mobile m = mobileRepository.findById(id)</span>
<span class="nc" id="L203">                .orElseThrow(() -&gt; new MobileNotFoundException(id));</span>
<span class="nc" id="L204">        m.setDeleted(true);</span>
<span class="nc" id="L205">        m.setDeletedAt(OffsetDateTime.now());</span>
<span class="nc" id="L206">        m.setStatus(Mobile.Status.DELETED);</span>
<span class="nc" id="L207">        mobileRepository.save(m);</span>
<span class="nc" id="L208">    }</span>



    @Override
    @Transactional
    public List&lt;String&gt; addImages(Long mobileId, List&lt;MultipartFile&gt; files) {
<span class="nc" id="L215">        Mobile mobile = mobileRepository.findById(mobileId)</span>
<span class="nc" id="L216">                .orElseThrow(() -&gt; new MobileNotFoundException(mobileId));</span>

<span class="nc" id="L218">        List&lt;String&gt; urls = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">        for (MultipartFile file : files) {</span>
            // Basic validation
<span class="nc bnc" id="L221" title="All 4 branches missed.">            if (file == null || file.isEmpty()) {</span>
<span class="nc" id="L222">                throw new MobileImageException(&quot;One of the uploaded files is empty&quot;);</span>
            }
<span class="nc" id="L224">            String contentType = file.getContentType();</span>
<span class="nc bnc" id="L225" title="All 4 branches missed.">            if (contentType == null || !contentType.startsWith(&quot;image/&quot;)) {</span>
<span class="nc" id="L226">                throw new MobileImageException(&quot;Invalid file type: &quot; + contentType);</span>
            }

            try {
<span class="nc" id="L230">                MultipartFile toUpload = file;</span>

                // If file is bigger than max allowed, try to compress
<span class="nc bnc" id="L233" title="All 2 branches missed.">                if (file.getSize() &gt; MAX_IMAGE_BYTES) {</span>
<span class="nc" id="L234">                    byte[] compressed = compressImageToMaxSize(file, MAX_IMAGE_BYTES);</span>
<span class="nc bnc" id="L235" title="All 4 branches missed.">                    if (compressed == null || compressed.length == 0) {</span>
<span class="nc" id="L236">                        throw new MobileImageException(&quot;Failed to compress image: &quot; + file.getOriginalFilename());</span>
                    }
<span class="nc bnc" id="L238" title="All 2 branches missed.">                    if (compressed.length &gt; MAX_IMAGE_BYTES) {</span>
<span class="nc" id="L239">                        throw new MobileImageException(&quot;Cannot reduce image below 400KB: &quot; + file.getOriginalFilename());</span>
                    }
                    // wrap bytes into MultipartFile so it can be passed to CloudinaryService
<span class="nc" id="L242">                    toUpload = new ByteArrayMultipartFile(</span>
                            compressed,
<span class="nc" id="L244">                            file.getOriginalFilename(),</span>
<span class="nc" id="L245">                            file.getContentType()</span>
                    );
                }

                // Upload to Cloudinary and get full result (secure_url + public_id)
<span class="nc" id="L250">                Map&lt;String, Object&gt; uploadResult = cloudinaryService.uploadFileWithResult(toUpload, &quot;mobiles&quot;);</span>
<span class="nc" id="L251">                String imageUrl = Objects.toString(uploadResult.get(&quot;secure_url&quot;), null);</span>
<span class="nc" id="L252">                String publicId = Objects.toString(uploadResult.get(&quot;public_id&quot;), null);</span>

                //  MobileImage with both URL and publicId
<span class="nc" id="L255">                MobileImage img = MobileImage.builder()</span>
<span class="nc" id="L256">                        .imageUrl(imageUrl)</span>
<span class="nc" id="L257">                        .publicId(publicId)</span>
<span class="nc" id="L258">                        .mobile(mobile)</span>
<span class="nc" id="L259">                        .build();</span>
<span class="nc" id="L260">                mobileImageRepository.save(img);</span>

<span class="nc" id="L262">                urls.add(imageUrl);</span>

<span class="nc" id="L264">            } catch (IOException e) {</span>
<span class="nc" id="L265">                throw new MobileImageException(&quot;Failed to upload image: &quot; + file.getOriginalFilename(), e);</span>
<span class="nc" id="L266">            }</span>
<span class="nc" id="L267">        }</span>

<span class="nc" id="L269">        return urls;</span>
    }


    //  compress image to fit under maxBytes (tries lowering JPEG quality)
    private byte[] compressImageToMaxSize(MultipartFile file, long maxBytes) throws IOException {

<span class="nc" id="L276">        BufferedImage inputImage = ImageIO.read(file.getInputStream());</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (inputImage == null) return null;</span>

        // We provide output in JPEG. This may strip transparency if source was PNG.
<span class="nc" id="L280">        String formatName = &quot;jpg&quot;;</span>

<span class="nc" id="L282">        int width = inputImage.getWidth();</span>
<span class="nc" id="L283">        int height = inputImage.getHeight();</span>

<span class="nc" id="L285">        float quality = 0.90f; // start quality</span>
<span class="nc" id="L286">        ByteArrayOutputStream baos = new ByteArrayOutputStream();</span>

        // Iteratively try reducing quality and then size until under maxBytes
<span class="nc bnc" id="L289" title="All 2 branches missed.">        for (int attempt = 0; attempt &lt; 10; attempt++) {</span>
<span class="nc" id="L290">            baos.reset();</span>

            // create a scaled copy if we shrank dimensions
<span class="nc" id="L293">            BufferedImage outputImage = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);</span>
<span class="nc" id="L294">            Graphics2D g2d = outputImage.createGraphics();</span>
<span class="nc" id="L295">            g2d.setRenderingHint(RenderingHints.KEY_INTERPOLATION, RenderingHints.VALUE_INTERPOLATION_BILINEAR);</span>
<span class="nc" id="L296">            g2d.drawImage(inputImage, 0, 0, width, height, null);</span>
<span class="nc" id="L297">            g2d.dispose();</span>

<span class="nc" id="L299">            Iterator&lt;ImageWriter&gt; writers = ImageIO.getImageWritersByFormatName(formatName);</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">            if (!writers.hasNext()) {</span>
<span class="nc" id="L301">                break;</span>
            }
<span class="nc" id="L303">            ImageWriter writer = writers.next();</span>
<span class="nc" id="L304">            ImageWriteParam param = writer.getDefaultWriteParam();</span>
<span class="nc bnc" id="L305" title="All 2 branches missed.">            if (param.canWriteCompressed()) {</span>
<span class="nc" id="L306">                param.setCompressionMode(ImageWriteParam.MODE_EXPLICIT);</span>
<span class="nc" id="L307">                param.setCompressionQuality(Math.max(0.10f, quality)); // limit lower bound</span>
            }

<span class="nc" id="L310">            try (ImageOutputStream ios = ImageIO.createImageOutputStream(baos)) {</span>
<span class="nc" id="L311">                writer.setOutput(ios);</span>
<span class="nc" id="L312">                writer.write(null, new IIOImage(outputImage, null, null), param);</span>
<span class="nc" id="L313">                writer.dispose();</span>
            }

            // If under max, return bytes
<span class="nc bnc" id="L317" title="All 2 branches missed.">            if (baos.size() &lt;= maxBytes) {</span>
<span class="nc" id="L318">                return baos.toByteArray();</span>
            }

            // otherwise reduce quality first, then dimensions
<span class="nc bnc" id="L322" title="All 2 branches missed.">            if (quality &gt; 0.35f) {</span>
<span class="nc" id="L323">                quality -= 0.15f; // reduce compression quality</span>
            } else {
                // reduce dimensions by 90% to try further reduction
<span class="nc" id="L326">                width = Math.max(100, (int) (width * 0.9));</span>
<span class="nc" id="L327">                height = Math.max(100, (int) (height * 0.9));</span>
            }
        }

        // final attempt: return whatever we have (may exceed maxBytes) or null
<span class="nc bnc" id="L332" title="All 2 branches missed.">        return baos.size() &gt; 0 ? baos.toByteArray() : null;</span>
    }

//    // Small adapter class to wrap compressed bytes into a MultipartFile
//    private static class ByteArrayMultipartFile implements MultipartFile {
//        private final byte[] bytes;
//        private final String originalFilename;
//        private final String contentType;
//
//        public ByteArrayMultipartFile(byte[] bytes, String originalFilename, String contentType) {
//            this.bytes = bytes;
//            this.originalFilename = originalFilename;
//            this.contentType = contentType;
//        }
//
//        @Override
//        public String getName() {
//            return originalFilename;
//        }
//
//        @Override
//        public String getOriginalFilename() {
//            return originalFilename;
//        }
//
//        @Override
//        public String getContentType() {
//            return contentType;
//        }
//
//        @Override
//        public boolean isEmpty() {
//            return bytes == null || bytes.length == 0;
//        }
//
//        @Override
//        public long getSize() {
//            return bytes == null ? 0 : bytes.length;
//        }
//
//        @Override
//        public byte[] getBytes() {
//            return bytes;
//        }
//
//        @Override
//        public InputStream getInputStream() {
//            return new ByteArrayInputStream(bytes);
//        }
//
//        @Override
//        public void transferTo(File dest) throws IOException {
//            try (FileOutputStream fos = new FileOutputStream(dest)) {
//                fos.write(bytes);
//            }
//        }
//    }

    // ================================================= //
    // in this method the image size is not defined //
  //==========================================================//

//    @Override
//    @Transactional
//    public List&lt;String&gt; addImages(Long mobileId, List&lt;MultipartFile&gt; files) {
//        Mobile mobile = mobileRepository.findById(mobileId)
//                .orElseThrow(() -&gt; new MobileNotFoundException(mobileId));
//
//        List&lt;String&gt; urls = new ArrayList&lt;&gt;();
//        for (MultipartFile file : files) {
//            try {
//                // Get  upload result
//                Map&lt;String, Object&gt; uploadResult = cloudinaryService.uploadFileWithResult(file, &quot;mobiles&quot;);
//
//                String imageUrl = (String) uploadResult.get(&quot;secure_url&quot;);
//                String publicId = (String) uploadResult.get(&quot;public_id&quot;);
//
//                // Save both in DB
//                MobileImage image = MobileImage.builder()
//                        .imageUrl(imageUrl)
//                        .publicId(publicId)
//                        .mobile(mobile)
//                        .build();
//
//                mobileImageRepository.save(image);
//                urls.add(imageUrl);
//
//            } catch (IOException e) {
//                throw new MobileImageException(&quot;Failed to upload image: &quot; + file.getOriginalFilename(), e);
//            }
//        }
//        return urls;
//    }


    @Override
    @Transactional
    public void deleteImage(Long imageId) {
<span class="nc" id="L430">        MobileImage image = mobileImageRepository.findById(imageId)</span>
<span class="nc" id="L431">                .orElseThrow(() -&gt; new MobileImageException(&quot;Mobile image not found with ID: &quot; + imageId));</span>

        try {
            //  first image will delete from cloudnairy then DB
<span class="nc" id="L435">            boolean deleted = cloudinaryService.deleteByPublicId(image.getPublicId());</span>
<span class="nc bnc" id="L436" title="All 2 branches missed.">            if (!deleted) {</span>
<span class="nc" id="L437">                throw new MobileImageException(&quot;Failed to delete image from Cloudinary: &quot; + image.getPublicId());</span>
            }

            //  Then delete from DB
<span class="nc" id="L441">            mobileImageRepository.delete(image);</span>

<span class="nc" id="L443">        } catch (IOException e) {</span>
<span class="nc" id="L444">            throw new MobileImageException(&quot;Error deleting image from Cloudinary: &quot; + image.getPublicId(), e);</span>
<span class="nc" id="L445">        }</span>
<span class="nc" id="L446">    }</span>


    public MobileImage uploadMobileImage(Long mobileId, MultipartFile file) {
<span class="nc" id="L450">        Mobile mobile = mobileRepository.findById(mobileId)</span>
<span class="nc" id="L451">                .orElseThrow(() -&gt; new MobileNotFoundException(mobileId));</span>

        try {
<span class="nc" id="L454">            String imageUrl = cloudinaryService.uploadFile(file, &quot;mobiles&quot;);</span>
<span class="nc" id="L455">            MobileImage image = new MobileImage();</span>
<span class="nc" id="L456">            image.setMobile(mobile);</span>
<span class="nc" id="L457">            image.setImageUrl(imageUrl);</span>
<span class="nc" id="L458">            return mobileImageRepository.save(image);</span>
<span class="nc" id="L459">        } catch (IOException e) {</span>
<span class="nc" id="L460">            throw new MobileImageException(&quot;Failed to upload image: &quot; + file.getOriginalFilename(),e);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Laptop Auction - Socket.IO</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

    <style>
        body { font-family: Arial; margin: 30px; }
        h2 { margin-top: 30px; }
        input { padding: 6px; margin: 5px; width: 200px; }
        button { padding: 8px 16px; margin: 5px; cursor: pointer; }
        .box { border: 1px solid #ccc; padding: 15px; margin-top: 20px; }
        #status { font-weight: bold; margin-top: 10px; }
        ul { padding-left: 20px; }
        .log { font-size: 12px; color: #444; max-height: 120px; overflow-y: auto; }
    </style>
</head>

<body>
<h1>üíª Laptop Auction (Socket.IO)</h1>

<div class="box">
    <h2>1Ô∏è‚É£ Connection</h2>
    <button onclick="connectSocket()">Connect</button>
    <div id="status">Status: Disconnected</div>
    <div class="log" id="debugLog"></div>
</div>

<div class="box">
    <h2>2Ô∏è‚É£ Join Auction</h2>
    <input type="number" id="auctionId" placeholder="Auction ID">
    <button onclick="joinAuction()">Join Auction</button>
</div>

<div class="box">
    <h2>üî• Live Auctions</h2>
    <ul id="liveAuctions"></ul>
</div>

<div class="box">
    <h2>3Ô∏è‚É£ Place Bid</h2>
    <input type="number" id="bidderId" placeholder="Your User ID">
    <input type="number" id="bidAmount" placeholder="Bid Amount">
    <button onclick="placeBid()">Place Bid</button>
    <div id="bidResponse"></div>
</div>

<div class="box">
    <h2>üèÜ Top Bid</h2>
    <div id="topBid">No bids yet</div>
</div>

<div class="box">
    <h2>üî• Top 3 Bids</h2>
    <ul id="topThreeBids"></ul>
</div>

<script>
    let socket = null;
    let currentAuctionId = null;

    function log(m) {
        const d = document.getElementById("debugLog");
        d.innerHTML += m + "<br/>";
        d.scrollTop = d.scrollHeight;
    }

    function status(t, c) {
        const el = document.getElementById("status");
        el.innerText = "Status: " + t;
        el.style.color = c;
    }

    function connectSocket() {
        if (socket && socket.connected) return;

        socket = io("http://localhost:3000", { transports: ["websocket"] });

        socket.on("connect", () => {
            log("CONNECTED " + socket.id);
            status("Connected", "green");
            socket.emit("getLiveAuctions");
        });

        socket.on("disconnect", () => {
            status("Disconnected", "red");
        });

        socket.on("liveAuctions", list => {
            const ul = document.getElementById("liveAuctions");
            ul.innerHTML = "";

            if (!list || list.length === 0) {
                ul.innerHTML = "<li>No live auctions</li>";
                return;
            }

            list.forEach(item => {
                const li = document.createElement("li");
                li.id = "auction_" + item.auctionId;
                li.innerText =
                    "Auction #" + item.auctionId +
                    " | ‚Çπ" + item.currentPrice +
                    " | Bidder: " + (item.highestBidder ?? "None");
                ul.appendChild(li);
            });
        });

        socket.on("joinAuctionResponse", msg => log("‚úî " + msg));
        socket.on("placeLaptopBidResponse", msg => log("‚úî " + msg));

        socket.on("laptopTopBid", bid => {
            if (!bid) return;
            document.getElementById("topBid").innerText =
                "‚Çπ" + bid.bidAmount + " by User " + bid.bidderId;
        });

        socket.on("laptopTopThreeBids", list => {
            const ul = document.getElementById("topThreeBids");
            ul.innerHTML = "";
            list.forEach(b =>
                ul.innerHTML += `<li>User ${b.bidderId} ‚Üí ‚Çπ${b.bidAmount}</li>`
            );
        });
    }

    function joinAuction() {
        const id = document.getElementById("auctionId").value;
        if (!id) return alert("Enter Auction ID");

        currentAuctionId = Number(id);
        socket.emit("joinAuction", currentAuctionId);
        log("Joining auction " + currentAuctionId);
    }

    function placeBid() {
        const bidder = document.getElementById("bidderId").value;
        const amount = document.getElementById("bidAmount").value;

        if (!currentAuctionId) return alert("Join auction first!");
        if (!bidder || !amount) return alert("Bidder & Amount required");

        socket.emit("placeLaptopBid", {
            auctionId: currentAuctionId,
            bidderUserId: Number(bidder),
            amount: Number(amount)
        });

        log("Bid sent ‚Çπ" + amount);
    }
</script>

</body>
</html>

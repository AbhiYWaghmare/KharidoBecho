<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Auction & Chat WebSocket Tester</title>-->
<!--    &lt;!&ndash; SockJS + STOMP (from CDN) &ndash;&gt;-->
<!--    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>-->
<!--    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>-->
<!--    <style>-->
<!--        body { font-family: Arial, sans-serif; margin: 20px; }-->
<!--        fieldset { margin-bottom: 20px; }-->
<!--        legend { font-weight: bold; }-->
<!--        label { display: inline-block; width: 130px; }-->
<!--        input[type="text"], input[type="number"] { width: 300px; }-->
<!--        textarea { width: 100%; height: 150px; margin-top: 10px; }-->
<!--        button { margin-top: 5px; margin-right: 5px; }-->
<!--        #status { font-weight: bold; margin-bottom: 10px; }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->

<!--<h2>Auction & Chat WebSocket Tester (STOMP)</h2>-->

<!--<div id="status">Status: DISCONNECTED</div>-->

<!--&lt;!&ndash; Connection Section &ndash;&gt;-->
<!--<fieldset>-->
<!--    <legend>1. Connect</legend>-->
<!--    <div>-->
<!--        <label>WS Endpoint:</label>-->
<!--        <input type="text" id="wsUrl" value="http://localhost:8087/ws-auction">-->
<!--        <span>(SockJS URL)</span>-->
<!--    </div>-->
<!--    &lt;!&ndash; ðŸ”¥ removed JWT token field completely &ndash;&gt;-->
<!--    <button onclick="connect()">Connect</button>-->
<!--    <button onclick="disconnect()">Disconnect</button>-->
<!--</fieldset>-->

<!--&lt;!&ndash; Subscription Section &ndash;&gt;-->
<!--<fieldset>-->
<!--    <legend>2. Subscribe</legend>-->
<!--    <div>-->
<!--        <label>Auction ID:</label>-->
<!--        <input type="number" id="auctionId" value="1">-->
<!--        <button onclick="subscribeAuction()">Subscribe Auction</button>-->
<!--    </div>-->
<!--    <div>-->
<!--        <label>Request ID (Chat):</label>-->
<!--        <input type="number" id="requestId" value="6">-->
<!--        <button onclick="subscribeChat()">Subscribe Chat</button>-->
<!--    </div>-->
<!--</fieldset>-->

<!--&lt;!&ndash; User ID &ndash;&gt;-->
<!--<fieldset>-->
<!--    <legend>3. User Info</legend>-->
<!--    <div>-->
<!--        <label>User ID:</label>-->
<!--        &lt;!&ndash; put some test userId (e.g. existing buyer userId like 10005) &ndash;&gt;-->
<!--        <input type="number" id="userId" value="10005">-->
<!--        <span>(this will be sent in bid/chat payload)</span>-->
<!--    </div>-->
<!--</fieldset>-->

<!--&lt;!&ndash; Send BID &ndash;&gt;-->
<!--<fieldset>-->
<!--    <legend>4. Send Bid</legend>-->
<!--    <div>-->
<!--        <label>Bid Amount:</label>-->
<!--        <input type="number" id="bidAmount" value="11000">-->
<!--    </div>-->
<!--    <button onclick="sendBid()">Send Bid</button>-->
<!--</fieldset>-->

<!--&lt;!&ndash; Send CHAT &ndash;&gt;-->
<!--<fieldset>-->
<!--    <legend>5. Send Chat Message</legend>-->
<!--    <div>-->
<!--        <label>Chat Message:</label>-->
<!--        <input type="text" id="chatMessage" value="Hello, I'm interested!">-->
<!--    </div>-->
<!--    <button onclick="sendChat()">Send Chat</button>-->
<!--</fieldset>-->

<!--&lt;!&ndash; Log Output &ndash;&gt;-->
<!--<fieldset>-->
<!--    <legend>Logs</legend>-->
<!--    <textarea id="log" readonly></textarea>-->
<!--    <button onclick="clearLog()">Clear Log</button>-->
<!--</fieldset>-->

<!--<script>-->
<!--    let stompClient = null;-->
<!--    let connected = false;-->

<!--    function log(message) {-->
<!--        const logArea = document.getElementById('log');-->
<!--        logArea.value += message + "\n";-->
<!--        logArea.scrollTop = logArea.scrollHeight;-->
<!--        console.log(message);-->
<!--    }-->

<!--    function setStatus(text) {-->
<!--        document.getElementById('status').innerText = 'Status: ' + text;-->
<!--    }-->

<!--    function connect() {-->
<!--        const baseUrl = document.getElementById('wsUrl').value.trim();-->

<!--        if (!baseUrl) {-->
<!--            alert('Please enter WebSocket URL');-->
<!--            return;-->
<!--        }-->

<!--        // ðŸ”¥ No token, just plain SockJS URL-->
<!--        const fullUrl = baseUrl;-->

<!--        log('Connecting to: ' + fullUrl);-->

<!--        const socket = new SockJS(fullUrl);-->
<!--        stompClient = Stomp.over(socket);-->

<!--        // Optional: disable debug logs-->
<!--        stompClient.debug = null;-->

<!--        stompClient.connect({}, function (frame) {-->
<!--            connected = true;-->
<!--            setStatus('CONNECTED');-->
<!--            log('Connected: ' + frame);-->
<!--        }, function (error) {-->
<!--            connected = false;-->
<!--            setStatus('ERROR');-->
<!--            log('Error: ' + error);-->
<!--        });-->
<!--    }-->

<!--    function disconnect() {-->
<!--        if (stompClient !== null) {-->
<!--            stompClient.disconnect(function () {-->
<!--                setStatus('DISCONNECTED');-->
<!--                log('Disconnected');-->
<!--            });-->
<!--        }-->
<!--        connected = false;-->
<!--    }-->

<!--    function subscribeAuction() {-->
<!--        if (!connected) {-->
<!--            alert('Connect first');-->
<!--            return;-->
<!--        }-->
<!--        const auctionId = document.getElementById('auctionId').value;-->
<!--        const destination = '/topic/auction/' + auctionId;-->

<!--        log('Subscribing to: ' + destination);-->

<!--        stompClient.subscribe(destination, function (message) {-->
<!--            log('[AUCTION ' + auctionId + '] ' + message.body);-->
<!--        });-->
<!--    }-->

<!--    function subscribeChat() {-->
<!--        if (!connected) {-->
<!--            alert('Connect first');-->
<!--            return;-->
<!--        }-->
<!--        const requestId = document.getElementById('requestId').value;-->
<!--        const destination = '/topic/chat/' + requestId;-->

<!--        log('Subscribing to: ' + destination);-->

<!--        stompClient.subscribe(destination, function (message) {-->
<!--            log('[CHAT ' + requestId + '] ' + message.body);-->
<!--        });-->
<!--    }-->

<!--    function sendBid() {-->
<!--        if (!connected) {-->
<!--            alert('Connect first');-->
<!--            return;-->
<!--        }-->
<!--        const auctionId = document.getElementById('auctionId').value;-->
<!--        const bidAmount = document.getElementById('bidAmount').value;-->
<!--        const userId = document.getElementById('userId').value;-->

<!--        const destination = '/app/auction/' + auctionId + '/bid';-->
<!--        const payload = {-->
<!--            userId: Number(userId),      // ðŸ”¥ send userId-->
<!--            auctionId: Number(auctionId),-->
<!--            bidAmount: Number(bidAmount)-->
<!--        };-->

<!--        log('Sending BID to ' + destination + ': ' + JSON.stringify(payload));-->
<!--        stompClient.send(destination, {}, JSON.stringify(payload));-->
<!--    }-->

<!--    function sendChat() {-->
<!--        if (!connected) {-->
<!--            alert('Connect first');-->
<!--            return;-->
<!--        }-->
<!--        const requestId = document.getElementById('requestId').value;-->
<!--        const message = document.getElementById('chatMessage').value;-->
<!--        const userId = document.getElementById('userId').value;-->

<!--        const destination = '/app/chat/' + requestId + '/send';-->
<!--        const payload = {-->
<!--            userId: Number(userId),      //  send userId-->
<!--            message: message-->
<!--        };-->

<!--        log('Sending CHAT to ' + destination + ': ' + JSON.stringify(payload));-->
<!--        stompClient.send(destination, {}, JSON.stringify(payload));-->
<!--    }-->

<!--    function clearLog() {-->
<!--        document.getElementById('log').value = '';-->
<!--    }-->
<!--</script>-->

<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Laptop Auction - Live WebSocket UI</title>

    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

    <style>
        body { font-family: Arial; margin: 20px; background: #f2f2f2; }
        fieldset { margin-bottom: 20px; padding: 15px; background: #fff; border-radius: 8px; }
        textarea { width: 100%; height: 180px; }
        .auction-card {
            padding: 10px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        .live { color: green; font-weight: bold; }
        .ended { color: red; font-weight: bold; }
        button { padding: 6px 12px; }
    </style>
</head>
<body>

<h2>ðŸ’» Laptop LIVE Auction Dashboard</h2>

<div id="status">Status: DISCONNECTED</div>

<fieldset>
    <div>
        <label>WS Endpoint:</label>
        <input type="text" id="wsUrl" value="http://localhost:8087/ws-auction">
    </div>

    <button onclick="connect()">Connect</button>
    <button onclick="disconnect()">Disconnect</button>
</fieldset>

<fieldset>
    <legend>LIVE Auctions</legend>
    <button onclick="subscribeLiveAuctions()">Start Listening</button>

    <div id="liveAuctionsContainer" style="margin-top:10px;">
        <i>No live auctions yet...</i>
    </div>
</fieldset>

<fieldset>
    <legend>Subscribe to an Auction</legend>
    Auction ID:
    <input type="number" id="auctionId" value="1">
    <button onclick="subscribeAuction()">Subscribe</button>
</fieldset>

<fieldset>
    <legend>Place a Bid</legend>
    User ID:
    <input type="number" id="userId" value="10005"><br><br>

    Bid Amount:
    <input type="number" id="bidAmount" value="20000">
    <button onclick="sendBid()">Send Bid</button>
</fieldset>

<fieldset>
    <legend>Chat System</legend>
    Request ID:
    <input type="number" id="requestId" value="3">
    <button onclick="subscribeChat()">Subscribe Chat</button><br><br>

    Message:
    <input type="text" id="chatMessage" value="Hello!" style="width:300px;">
    <button onclick="sendChat()">Send</button>
</fieldset>

<fieldset>
    <legend>Logs</legend>
    <textarea id="log" readonly></textarea>
</fieldset>

<script>

    let stompClient = null;
    let liveAuctions = {};

    function log(msg) {
        const area = document.getElementById("log");
        area.value += msg + "\n";
        area.scrollTop = area.scrollHeight;
        console.log(msg);
    }

    function setStatus(msg) {
        document.getElementById("status").innerText = "Status: " + msg;
    }

    // CONNECT --------------------------------------------------------------
    function connect() {

        const baseUrl = document.getElementById("wsUrl").value.trim();

        if (!baseUrl) {
            alert('Please enter WebSocket URL');
            return;
        }

        log('Connecting to: ' + baseUrl);

        const socket = new SockJS(baseUrl);
        stompClient = Stomp.over(socket);
        stompClient.debug = null;

        stompClient.connect({}, frame => {
            setStatus("CONNECTED");
            log("Connected: " + frame);

            subscribeLiveAuctions();

        }, error => {
            setStatus("ERROR");
            log("Connection error: " + error);
        });
    }

    function disconnect() {
        if (stompClient) stompClient.disconnect(() => {
            setStatus("DISCONNECTED");
            log("Disconnected");
        });
    }

    // LIVE AUCTION LISTENER -----------------------------------------------
    function subscribeLiveAuctions() {
        if (!stompClient) return log("Connect first!");

        const topic = "/topic/laptop-auctions/live";
        log("Listening for LIVE auctions at " + topic);

        stompClient.subscribe(topic, msg => {
            const data = JSON.parse(msg.body);
            log("[LIVE EVENT] " + msg.body);

            if (data.type === "LIVE_AUCTION") {
                liveAuctions[data.auctionId] = data;
                updateLiveAuctionUI();
            }

            if (data.type === "AUCTION_ENDED") {
                delete liveAuctions[data.auctionId];
                updateLiveAuctionUI();
            }
        });
    }

    function updateLiveAuctionUI() {
        const container = document.getElementById("liveAuctionsContainer");

        if (Object.keys(liveAuctions).length === 0) {
            container.innerHTML = "<i>No live auctions right now...</i>";
            return;
        }

        container.innerHTML = Object.values(liveAuctions)
            .map(a => `
                <div class="auction-card">
                    <span class="live">LIVE AUCTION #${a.auctionId}</span><br>
                    Current Price: â‚¹${a.currentPrice}<br>
                    Highest Bidder: ${a.highestBidderUserId || "-"}<br>
                    <button onclick="subscribeAuctionId(${a.auctionId})">Subscribe to this Auction</button>
                </div>
            `)
            .join("");
    }

    function subscribeAuctionId(id) {
        document.getElementById("auctionId").value = id;
        subscribeAuction();
    }

    // MANUAL AUCTION SUBSCRIBE --------------------------------------------
    function subscribeAuction() {
        if (!stompClient) return log("Connect first!");

        const id = document.getElementById("auctionId").value;
        const topic = `/topic/laptop-auction/${id}`;
        log("Subscribing to " + topic);

        stompClient.subscribe(topic, msg => log("[AUCTION] " + msg.body));
    }

    // SEND BID -------------------------------------------------------------
    function sendBid() {
        if (!stompClient) return log("Connect first!");

        const auctionId = Number(document.getElementById("auctionId").value);
        const userId = Number(document.getElementById("userId").value);
        const amount = Number(document.getElementById("bidAmount").value);

        const destination = `/app/laptop/auction/${auctionId}/bid`;

        const payload = {
            userId: userId,
            auctionId: auctionId,
            bidAmount: amount
        };

        log("Sending BID â†’ " + JSON.stringify(payload));
        stompClient.send(destination, {}, JSON.stringify(payload));
    }

    // CHAT -----------------------------------------------------------------
    function subscribeChat() {
        if (!stompClient) return log("Connect first!");

        const id = document.getElementById("requestId").value;
        const topic = `/topic/laptop/chat/${id}`;
        log("Subscribing chat: " + topic);

        stompClient.subscribe(topic, msg => log("[CHAT] " + msg.body));
    }

    function sendChat() {
        if (!stompClient) return log("Connect first!");

        const id = document.getElementById("requestId").value;
        const destination = `/app/laptop/chat/${id}/send`;

        const payload = {
            userId: Number(document.getElementById("userId").value),
            message: document.getElementById("chatMessage").value
        };

        log("Sending CHAT â†’ " + JSON.stringify(payload));
        stompClient.send(destination, {}, JSON.stringify(payload));
    }

</script>

</body>
</html>
